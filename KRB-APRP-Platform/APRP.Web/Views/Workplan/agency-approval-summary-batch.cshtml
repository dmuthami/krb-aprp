
@model APRP.Web.ViewModels.GetRoadWorkPlanViewModel;
@using APRP.Web.Domain.Models;

@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers

@{
    ViewData["Title"] = "Index";
    Layout = "~/Views/Shared/_Layout_App.cshtml";
}


@section vendorCss
{

    <link rel="stylesheet" type="text/css" href="~/asset_default/app-assets/vendors/flag-icon/css/flag-icon.min.css" />
    <link rel="stylesheet" type="text/css" href="~/asset_default/app-assets/vendors/data-tables/css/jquery.dataTables.min.css" />
    <link rel="stylesheet" type="text/css" href="~/asset_default/app-assets/vendors/data-tables/extensions/responsive/css/responsive.dataTables.min.css" />
    <link rel="stylesheet" type="text/css" href="~/asset_default/app-assets/vendors/data-tables/css/select.dataTables.min.css">
    <link rel="stylesheet" type="text/css" href="~/asset_default/app-assets/vendors/dropify/css/dropify.min.css">
}

@section customCss
{
    <link rel="stylesheet" type="text/css" href="~/asset_default/app-assets/css/pages/app-chat.css">
    <link rel="stylesheet" type="text/css" href="~/asset_default/app-assets/css/pages/data-tables.css">
    <link href="~/asset_default/app-assets/vendors/sweetalert/sweetalert.css" type="text/css" rel="stylesheet" />
    <link rel="stylesheet" type="text/css" href="/asset_default/app-assets/css/pages/data-tables.css">


}

@section aside
{
    <!-- BEGIN: SideNav-->
    <aside class="sidenav-main nav-expanded nav-lock nav-collapsible sidenav-dark sidenav-active-rounded">

        <div class="brand-sidebar">
            <h1 class="logo-wrapper">
                <a class="brand-logo darken-1" asp-controller="Home" asp-action="Dashboard">
                    <img src="~/asset_default/app-assets/images/logo/menu-logo.png" alt="REPARS logo" /><span class="logo-text hide-on-med-and-down">REPARS</span>
                </a>
                <a class="navbar-toggler" href="#"><i class="material-icons">radio_button_checked</i></a>
            </h1>
        </div>

        <ul class="sidenav sidenav-collapsible leftside-navigation collapsible sidenav-fixed menu-shadow" id="slide-out" data-menu="menu-navigation" data-collapsible="accordion">
            <li class="bold">
                <a class="waves-effect waves-cyan " asp-controller="Home" asp-action="Dashboard"><i class="material-icons">home</i><span id="idHomeAuthority" class="menu-title" data-i18n="">Home</span></a>
            </li>

            <li class="bold">
                <a class="collapsible-header waves-effect waves-cyan" href="#">
                    <i class="material-icons">timeline</i>
                    <span class="menu-title" data-i18n="">Road Networks</span>
                </a>
                <div class="collapsible-body">
                    <ul class="collapsible collapsible-sub" data-collapsible="accordion">
                        <li>
                            <a asp-controller="Road" asp-action="Index" data-i18n="" class="collapsible-body">
                                <i class="material-icons">radio_button_unchecked</i><span>Road Network</span>
                            </a>
                        </li>
                        <li>
                            <a class="collapsible-header waves-effect waves-cyan" href="#">
                                <i class="material-icons">radio_button_unchecked</i>
                                <span class="menu-title" data-i18n="">Road Classification</span>
                            </a>
                            <div class="collapsible-body">
                                <ul class="collapsible collapsible-sub" data-collapsible="accordion">
                                    <li>
                                        <a class="collapsible-body" asp-controller="RoadClassCodeUnits" asp-action="Index" data-i18n=""><i class="material-icons">radio_button_unchecked</i><span>Road Class</span></a>
                                    </li>
                                    <li>
                                        <a class="collapsible-body" asp-controller="RoadConditionCodeUnits" asp-action="Index" data-i18n=""><i class="material-icons">radio_button_unchecked</i><span>Road Condition</span></a>
                                    </li>
                                    <li>
                                        <a class="collapsible-body" asp-controller="RoadClassifications" asp-action="Index" data-i18n=""><i class="material-icons">radio_button_unchecked</i><span>Road Classifications</span></a>
                                    </li>
                                </ul>
                            </div>
                        </li>
                    </ul>
                </div>
            </li>

            @if ((await AuthorizationService.AuthorizeAsync(User, "Permissions.Administrator.Role.View")).Succeeded)
            {
                <li class="bold">
                    <a class="collapsible-header waves-effect waves-cyan" href="#">
                        <i class="material-icons">supervisor_account</i>
                        <span class="menu-title" data-i18n="">User Management</span>
                    </a>
                    <div class="collapsible-body">
                        <ul class="collapsible collapsible-sub" data-collapsible="accordion">
                            <li>
                                <a class="collapsible-body" asp-page="/UserAccess/index" data-i18n=""><i class="material-icons">radio_button_unchecked</i><span>User Access List</span></a>
                            </li>
                            <li>
                                <a class="collapsible-body" asp-page="/users/index" data-i18n=""><i class="material-icons">radio_button_unchecked</i><span>Users</span></a>
                            </li>
                            <li>
                                <a class="collapsible-body" asp-page="/roles/index" data-i18n=""><i class="material-icons">radio_button_unchecked</i><span>Approvals</span></a>
                            </li>

                            <li>
                                <a class="collapsible-body" asp-controller="Permissions" asp-action="ListRoleClaims" data-i18n=""><i class="material-icons">radio_button_unchecked</i><span>Groups</span></a>
                            </li>
                        </ul>
                    </div>
                </li>
            }

            <!--ARICS Menu Group-->
            @if ((await AuthorizationService.AuthorizeAsync(User, "Permissions.ARICS.View")).Succeeded)
            {
                <li class="bold">
                    <a class="collapsible-header waves-effect waves-cyan " href="#"><i class="material-icons">filter_tilt_shift</i><span class="menu-title" data-i18n="">ARICS</span></a>
                    <div class="collapsible-body">
                        <ul class="collapsible collapsible-sub" data-collapsible="accordion">
                            @if ((await AuthorizationService.AuthorizeAsync(User, "Permissions.ARICS.ConductARICS")).Succeeded)
                            {
                                <li>
                                    <a asp-page="/ARICZ/UploadARICS" class="collapsible-body" data-i18n=""><i class="material-icons">radio_button_unchecked</i><span>Upload ARICS</span></a>
                                </li>
                            }
                            @if ((await AuthorizationService.AuthorizeAsync(User, "Permissions.ARICS.ConductARICS")).Succeeded)
                            {
                                <li>
                                    <a asp-page="/ARICZ/ConductARICS" class="collapsible-body" data-i18n=""><i class="material-icons">radio_button_unchecked</i><span>Direct Data Entry</span></a>
                                </li>
                            }
                            <li><a asp-page="/aricz/aricshome" class="collapsible-body" data-i18n=""><i class="material-icons">radio_button_unchecked</i><span>ARICS Summary</span></a></li>
                            <li><a asp-controller="arics" asp-action="aricsapprovalagency" class="collapsible-body" data-i18n=""><i class="material-icons">radio_button_unchecked</i><span>ARICS Approvals</span></a></li>
                        </ul>
                    </div>
                </li>
            }
            <!--End ARICS Menu Group-->


            @if ((await AuthorizationService.AuthorizeAsync(User, "Permissions.GIS.View")).Succeeded)
            {
                <li class="bold">
                    <a class="collapsible-header waves-effect waves-cyan " href="#"><i class="material-icons">filter_tilt_shift</i><span class="menu-title" data-i18n="">GIS</span></a>
                    <div class="collapsible-body">
                        <ul class="collapsible collapsible-sub" data-collapsible="accordion">
                            <li>
                                <a target="_blank" asp-page="/nrsmap/Index" class="collapsible-body" data-i18n=""><i class="material-icons">radio_button_unchecked</i><span>View GIS Roads</span></a>
                            </li>
                            @if ((await AuthorizationService.AuthorizeAsync(User, "Permissions.KENHA.GIS.View")).Succeeded)
                            {
                                <li>
                                    <a asp-controller="GIS" asp-action="IndexKENHA" class="collapsible-body" data-i18n=""><i class="material-icons">radio_button_unchecked</i><span>KenHA GIS </span></a>
                                </li>
                            }

                            @if ((await AuthorizationService.AuthorizeAsync(User, "Permissions.KURA.GIS.View")).Succeeded)
                            {
                                <li>
                                    <a asp-controller="GIS" asp-action="IndexKURA" data-i18n="" class="collapsible-body"><i class="material-icons">radio_button_unchecked</i><span>KuRA GIS </span></a>
                                </li>
                            }

                            @if ((await AuthorizationService.AuthorizeAsync(User, "Permissions.KERRA.GIS.View")).Succeeded)
                            {
                                <li>
                                    <a asp-controller="GIS" asp-action="IndexKERRA" data-i18n="" class="collapsible-body"><i class="material-icons">radio_button_unchecked</i><span>KeRRA GIS </span></a>
                                </li>
                            }

                            @if ((await AuthorizationService.AuthorizeAsync(User, "Permissions.KWS.GIS.View")).Succeeded)
                            {
                                <li>
                                    <a asp-controller="GIS" asp-action="IndexKWS" data-i18n="" class="collapsible-body"><i class="material-icons">radio_button_unchecked</i><span>KWS GIS</span></a>
                                </li>
                            }

                            @if ((await AuthorizationService.AuthorizeAsync(User, "Permissions.Counties.GIS.View")).Succeeded)
                            {
                                <li>
                                    <a asp-controller="GIS" asp-action="IndexCounties" data-i18n="" class="collapsible-body"><i class="material-icons"></i><span>Counties GIS</span></a>
                                </li>
                            }
                        </ul>
                    </div>
                </li>
            }

            <!--Budgeting Menu Group-->
            @if ((await AuthorizationService.AuthorizeAsync(User, "Permissions.Finance.View")).Succeeded)
            {
                <li class="bold">
                    <a class="collapsible-header waves-effect waves-cyan " href="#"><i class="material-icons">monetization_on</i><span class="menu-title" data-i18n="">Budgeting</span></a>
                    <div class="collapsible-body">
                        <ul class="collapsible collapsible-sub" data-collapsible="accordion">

                            <li>
                                <a asp-controller="Admin" asp-action="Index" class="collapsible-body" data-i18n=""><i class="material-icons">radio_button_unchecked</i><span>Financial Year</span></a>
                            </li>
                            <li>
                                <a class="collapsible-body" asp-page="/AllocationCodeUnitRx/index" data-i18n=""><i class="material-icons">radio_button_unchecked</i><span>Allocation Ratios</span></a>
                            </li>
                            <li>
                                <a class="collapsible-body" asp-page="/AllocationRx/index" data-i18n=""><i class="material-icons">radio_button_unchecked</i><span>Allocation Figures</span></a>
                            </li>
                            <li>
                                <a class="collapsible-body" asp-controller="RevenueCollectionCodeUnitTypes" asp-action="Index" data-i18n=""><i class="material-icons">radio_button_unchecked</i><span>Revenue Collection Types</span></a>
                            </li>
                            <li>
                                <a class="collapsible-body" asp-page="/RevenueCollectionCodeUnitRx/index" data-i18n=""><i class="material-icons">radio_button_unchecked</i><span>Revenue Collection Code Units</span></a>
                            </li>
                            <li>
                                <a class="collapsible-body" asp-page="/RevenueCollectionRx/index" data-i18n=""><i class="material-icons">radio_button_unchecked</i><span>Revenue Collection</span></a>
                            </li>
                            <li><a asp-controller="RevenueCollection" asp-action="Index" class="collapsible-body" data-i18n=""><i class="material-icons">radio_button_unchecked</i><span>Budget Approvals</span></a></li>
                            <li><a asp-controller="Disbursement" asp-action="Index" class="collapsible-body" data-i18n=""><i class="material-icons">radio_button_unchecked</i><span>Disbursement</span></a></li>
                        </ul>
                    </div>
                </li>
            }
            @if ((await AuthorizationService.AuthorizeAsync(User, "Permissions.WorkplanPermissions.View")).Succeeded)
            {
                <!--End Budgeting Menu Group-->
                <!--Workplanning Menu Group-->
                <li class="active bold">
                    <a class="collapsible-header waves-effect waves-cyan " href="#"><i class="material-icons">monetization_on</i><span class="menu-title" data-i18n="">Work Planning</span></a>
                    <div class="collapsible-body">
                        <ul class="collapsible collapsible-sub" data-collapsible="accordion">
                            <li>
                                <a asp-controller="workplan" asp-action="Prioritization" class="collapsible-body" data-i18n=""><i class="material-icons">radio_button_unchecked</i><span>Road Prioritization</span></a>
                            </li>
                            <li>
                                <a asp-controller="workplan" asp-action="GetRoadsForWorkPlan" class="active collapsible-body" data-i18n=""><i class="material-icons">radio_button_unchecked</i><span>Road Work Plan</span></a>
                            </li>
                            <li>
                                <a asp-controller="workplan" asp-action="Index" class="collapsible-body" data-i18n=""><i class="material-icons">radio_button_unchecked</i><span>ARWP Summary</span></a>
                            </li>
                        </ul>
                    </div>
                </li>
                <!--End Workplanning Menu Group-->
            }
            <li class="bold">
                <a class="collapsible-header waves-effect waves-cyan " href="#"><i class="material-icons">invert_colors</i><span class="menu-title" data-i18n="">Contract Management</span></a>
                <div class="collapsible-body">
                    <ul class="collapsible collapsible-sub" data-collapsible="accordion">
                        <li>
                            <a class="collapsible-body" asp-controller="WorkPlanPackage" asp-action="RoadWorkPackaging" asp-route-id="0" data-i18n=""><i class="material-icons">radio_button_unchecked</i><span>Work Packaging</span></a>
                        </li>
                        <li>
                            <a class="collapsible-body" asp-controller="WorkPlanPackage" asp-action="ContractDetails" asp-route-id="0" data-i18n=""><i class="material-icons">radio_button_unchecked</i><span>Contract Details</span></a>
                        </li>
                        <li>
                            <a class="collapsible-body" asp-controller="WorkPlanPackage" asp-action="ProjectProgressDetails" asp-route-id="0" data-i18n=""><i class="material-icons">radio_button_unchecked</i><span>Project Progress</span></a>
                        </li>
                    </ul>
                </div>
            </li>

            <li class="bold">
                <a class="waves-effect waves-cyan " asp-controller="Reports" asp-action="index"><i class="material-icons">import_contacts</i><span class="menu-title" data-i18n="">Report Management</span></a>
            </li>

            <li class="bold">
                <a class="waves-effect waves-cyan " asp-controller="Issue" asp-action="Index"><i class="material-icons">chat</i><span class="menu-title" data-i18n="">Complaints / Issues</span></a>
            </li>

            <li class="bold">
                <a class="collapsible-header waves-effect waves-cyan " href="#"><i class="material-icons">invert_colors</i><span class="menu-title" data-i18n="">Training</span></a>
                <div class="collapsible-body">
                    <ul class="collapsible collapsible-sub" data-collapsible="accordion">
                        @if ((await AuthorizationService.AuthorizeAsync(User, "Permissions.QuarterCodeList.View")).Succeeded)
                        {
                            <li>
                                <a class="collapsible-body" asp-page="/QuarterCodeListRx/Index" data-i18n=""><i class="material-icons"></i><span>Quarter Code List</span></a>
                            </li>
                        }

                        @if ((await AuthorizationService.AuthorizeAsync(User, "Permissions.QuarterCodeUnit.View")).Succeeded)
                        {
                            <li>
                                <a class="collapsible-body" asp-page="/QuarterCodeUnitRx/Index" data-i18n=""><i class="material-icons">radio_button_unchecked</i><span>Quarter Code Unit</span></a>
                            </li>
                        }

                        @if ((await AuthorizationService.AuthorizeAsync(User, "Permissions.TrainingCourse.View")).Succeeded)
                        {
                            <li>
                                <a class="collapsible-body" asp-controller="TrainingCourses"
                                   asp-action="Index" data-i18n="">
                                    <i class="material-icons">radio_button_unchecked</i>
                                    <span>Courses</span>
                                </a>
                            </li>
                        }
                        <li>
                            <a class="collapsible-body" asp-page="/TrainingRx/Index" data-i18n=""><i class="material-icons">radio_button_unchecked</i><span>Training</span></a>
                        </li>

                        @if ((await AuthorizationService.AuthorizeAsync(User, "Permissions.Training.Report")).Succeeded)
                        {
                            <li>
                                <a class="collapsible-body" asp-controller="Training" asp-action="Index" data-i18n=""><i class="material-icons">radio_button_unchecked</i><span>Training Report</span></a>
                            </li>
                        }
                    </ul>
                </div>
            </li>
            <!--Administration Menu Group-->
            @if ((await AuthorizationService.AuthorizeAsync(User, "Permissions.Administrator.Role.View")).Succeeded)
            {
                <li class="bold">
                    <a class="collapsible-header waves-effect waves-cyan " href="#"><i class="material-icons">add_to_queue</i><span class="menu-title" data-i18n="">Admin</span></a>
                    <div class="collapsible-body">
                        <ul class="collapsible collapsible-sub" data-collapsible="accordion">

                            @if ((await AuthorizationService.AuthorizeAsync(User, "Permissions.ActivityGroup.View")).Succeeded)
                            {
                                <li>
                                    <a asp-controller="Admin" asp-action="UnitCost" class="collapsible-body" data-i18n=""><i class="material-icons">radio_button_unchecked</i><span>Activity Code List</span></a>
                                </li>
                            }

                            @if ((await AuthorizationService.AuthorizeAsync(User, "Permissions.FundingSource.View")).Succeeded)
                            {
                                <li>
                                    <a class="collapsible-body" asp-controller="Admin" asp-action="FundingSources" data-i18n=""><i class="material-icons">radio_button_unchecked</i><span>Funding Sources</span></a>
                                </li>
                            }

                            @if ((await AuthorizationService.AuthorizeAsync(User, "Permissions.FundType.View")).Succeeded)
                            {
                                <li>
                                    <a class="collapsible-body" asp-controller="Admin" asp-action="FundTypes" data-i18n=""><i class="material-icons">radio_button_unchecked</i><span>Fund Types</span></a>
                                </li>
                            }

                            @if ((await AuthorizationService.AuthorizeAsync(User, "Permissions.Authority.View")).Succeeded)
                            {
                                <li>
                                    <a class="collapsible-body" asp-controller="Admin" asp-action="Authorities" data-i18n=""><i class="material-icons">radio_button_unchecked</i><span>Authorities</span></a>
                                </li>
                            }

                                                        @if ((await AuthorizationService.AuthorizeAsync(User, "Permissions.Contractor.View")).Succeeded){<li><a class="collapsible-body" asp-controller="Admin" asp-action="Contractors" data-i18n=""><i class="material-icons">radio_button_unchecked</i><span>Contractors</span></a></li>}@if ((await AuthorizationService.AuthorizeAsync(User, "Permissions.ARICSYear.View")).Succeeded){<li><a class="collapsible-body" asp-controller="ARICS" asp-action="ARICSYearIndex" data-i18n=""><i class="material-icons">radio_button_unchecked</i><span>Calendar Year</span></a></li>}
                        </ul>
                    </div>
                </li>
            }
            <!--End Administration Menu Group-->
        </ul>
        <div class="navigation-background"></div>
        <a class="sidenav-trigger btn-sidenav-toggle btn-floating btn-medium waves-effect waves-light hide-on-large-only" href="#" data-target="slide-out"><i class="material-icons">menu</i></a>
    </aside>
    <!-- END: SideNav-->
}


<!-- Content Area Starts -->
<div class="chat-application">
    <div class="chat-content-head">
        <div class="header-details">
            <h5 class="m-0 sidebar-title">
                <span> Work Program Approvals Summary</span>
            </h5>
        </div>
    </div>

    <!-- Scroll - vertical, dynamic height -->
    <div class="row">
        <div class="col s12 m12 l12">
            <div class="card">
                <div class="card-content pb-1">
                    <div class="row">
                        <div class="col s12 m12 l12">
                            <a class="waves-effect waves-light btn-small" asp-controller="workplan" asp-action="Index" asp-route-viewname="agency-summary"><i class="material-icons left">arrow_back</i> Go to ARWP Summary</a>
                            <span class="right">
                                <a class="waves-effect waves-light btn" href="#!" onclick="DownloadARWP(@Model.Authority.ID)">
                                    Download ARWP <i class="material-icons left">file_download</i>
                                </a>

                                <a class="waves-effect waves-light btn" href="#!" onclick="DownloadAPRP(@Model.Authority.ID)">
                                    Download APRP <i class="material-icons left">file_download</i>
                                </a>
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <!--card stats start-->
        <div class="col s12 m6 l12">
            <div class="card  card-default #f1f8e9 light-green lighten-5">
                <div class="card-content">
                    <div class="row section">

                        <div class="col s6">

                            <p>
                                <h4 class="card-title strong black-text">
                                    Total Allocated Budget for Road Works :
                                    <span class="#eeeeee grey lighten-3 strong  black-text">
                                        KSH  @ViewBag.BudgetAllocated.ToString("N")
                                    </span>
                                </h4>
                            </p>
                            <p>
                                <h4 class="card-title strong black-text">
                                    Authority :
                                    <span class="#eeeeee grey lighten-3 strong  black-text">
                                        @Model.Authority.Name
                                    </span>
                                </h4>
                            </p>
                            <p>
                                <h4 class="card-title strong black-text">
                                    Funding Source :
                                    <span class="#eeeeee grey lighten-3 strong  black-text">

                                    </span>
                                </h4>
                            </p>
                        </div>
                        <div class="col s6">
                            <p>
                                <h4 class="card-title strong black-text">
                                    Total Workplan Cost : <span class="#eeeeee grey lighten-3 strong  black-text">

                                        KSHS @ViewBag.totalWorkplanCost.ToString("N")
                                    </span>

                                </h4>
                            </p>
                            <p>
                                <h4 class="card-title strong black-text">
                                    Financial Year :
                                    <span class="#eeeeee grey lighten-3 strong  black-text">
                                        @ViewBag.FinancialYear
                                    </span>
                                </h4>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card animate fadeRight">
                <div class="row card-content pb-1">
                    <div class="col s12 m6 l12 xl12">
                        <h4 class="card-title mb-0">
                            Non R200O Strategy Roads for approval
                        </h4>
                    </div>
                </div>
                <div class="row card-content">
                    <div class="col s12 m6 l12 xl12">
                        <table class="subscription-table responsive-table highlight">
                            <thead>
                                <tr>
                                    <th>Road ID</th>
                                    <th>Section Name</th>
                                    <th>Surface Type</th>
                                    <th>Length (KM)</th>
                                    <th>Activity Code</th>
                                    <th>Acivity Description</th>
                                    <th>Unit</th>
                                    <th>Planned Quantity</th>
                                    <th>Planned Rate</th>
                                    <th>Amount (Ksh)</th>
                                </tr>
                            </thead>
                            <tbody>
                                @if (Model.WorkplanRoads.Any())
                                {
                                    long roadId = 0;
                                    foreach (var roadVar in Model.WorkplanRoads.OrderBy(i => i.Road.RoadNumber))
                                    {

                                        if (roadVar.Road.RoadWorkSectionPlans != null && Model.approvalAuthority != "COUNTY")
                                        {
                                            var countRow = 0;

                                            foreach (var sectionPln in roadVar.Road.RoadWorkSectionPlans.Where(a => a.Authority.Code == Model.approvalAuthority))
                                            {
                                                if (countRow == 0)
                                                {
                                                    <tr class="black-text light-green lighten-5 bold strong">
                                                        <td colspan="10">
                                                            <span class="right">Road : @roadVar.Road.RoadName |  IRI / ARD : @String.Format("{0:0.00}", roadVar.RateOfDeterioration) | Road Total Estimate KSH @roadVar.Road.RoadWorkSectionPlans.Sum(t => t.TotalEstimateCost).ToString("N") </span>
                                                        </td>
                                                    </tr>
                                                    countRow++;
                                                }
                                                @if (sectionPln.PlanActivities != null)
                                                {
                                                    foreach (var activity in sectionPln.PlanActivities)
                                                    {
                                                        <tr>
                                                            @if (roadId != sectionPln.RoadSection.ID)
                                                            {
                                                                //first time the section is met
                                                                <td>
                                                                    @(sectionPln.Road != null ? sectionPln.Road.RoadNumber: "")
                                                                </td>
                                                                <td class="strong">
                                                                    @sectionPln.RoadSection.SectionName
                                                                </td>
                                                                <td>
                                                                    @(sectionPln.RoadSection.SurfaceType != null ? sectionPln.RoadSection.SurfaceType.Name : "")
                                                                </td>
                                                                <td> @sectionPln.RoadSection.Length.ToString("N")</td>
                                                            }
                                                            else
                                                            {
                                                                <td>&nbsp;</td>
                                                                <td>&nbsp;</td>
                                                                <td>&nbsp;</td>
                                                                <td>&nbsp;</td>
                                                            }
                                                            @{
                                                                //set the road ID to the outputted section ID, so that next time if repeated code above does not execute
                                                                roadId = sectionPln.RoadSection.ID;
                                                            }
                                                            <td>@(activity.ItemActivityUnitCost.ItemCode +"-" + activity.ItemActivityUnitCost.SubItemCode + "-" + activity.ItemActivityUnitCost.SubSubItemCode) </td>
                                                            <td>@activity.ItemActivityUnitCost.Description </td>
                                                            <td>@activity.ItemActivityUnitCost.UnitCode </td>
                                                            <td>@activity.Quantity.ToString("N") </td>
                                                            <td>@activity.Rate.ToString("N")</td>
                                                            <td>@activity.Amount.ToString("N")</td>

                                                        </tr>
                                                    }
                                                }

                                                @if (sectionPln.PlanActivityPBCs != null)
                                                {
                                                    foreach (var activity in sectionPln.PlanActivityPBCs)
                                                    {
                                                        <tr>
                                                            @if (roadId != sectionPln.RoadSection.ID)
                                                            {
                                                                //first time the section is met
                                                                <td>
                                                                    @(sectionPln.Road != null ? sectionPln.Road.RoadNumber: "")
                                                                </td>
                                                                <td class="strong">
                                                                    @sectionPln.RoadSection.SectionName
                                                                </td>
                                                                <td>
                                                                    @(sectionPln.RoadSection.SurfaceType != null ? sectionPln.RoadSection.SurfaceType.Name : "")
                                                                </td>
                                                                <td> @sectionPln.RoadSection.Length.ToString("N")</td>
                                                            }
                                                            else
                                                            {
                                                                <td>&nbsp;</td>
                                                                <td>&nbsp;</td>
                                                                <td>&nbsp;</td>
                                                                <td>&nbsp;</td>
                                                            }
                                                            @{
                                                                //set the road ID to the outputted section ID, so that next time if repeated code above does not execute
                                                                roadId = sectionPln.RoadSection.ID;
                                                            }
                                                            <td>@(activity.ItemActivityPBC.Code) </td>
                                                            <td>@activity.ItemActivityPBC.Description </td>
                                                            <td> <span>Cost Per KM</span> </td>
                                                            <td>@activity.PlannedKM) </td>
                                                            <td>@activity.CostPerKMPerMonth</td>
                                                            <td>@activity.TotalAmount.ToString("N")</td>

                                                        </tr>
                                                    }

                                                }
                                                @if (sectionPln.PlanActivities != null || sectionPln.PlanActivityPBCs != null)
                                                {
                                                    // generate summaries for subtotal
                                                    var totalWorkplan = sectionPln.TotalEstimateCost;
                                                    var totalWorkplanWithVAT = (totalWorkplan * 1.16);
                                                    var VAT = (0.16 * totalWorkplan);
                                                    <tr class="bold">
                                                        <td colspan="7">&nbsp; </td>
                                                        <td colspan="2"> Subtotal (KSH) </td>
                                                        <td>@totalWorkplan.ToString("N") </td>
                                                    </tr>
                                                    <tr class="bold">
                                                        <td colspan="7">&nbsp; </td>
                                                        <td colspan="2">16% VAT </td>
                                                        <td>@VAT.ToString("N") </td>
                                                    </tr>
                                                    <tr class="bold">
                                                        <td colspan="7">&nbsp; </td>
                                                        <td colspan="2">Contigencies (0 %) </td>
                                                        <td> <span> - </span> </td>
                                                    </tr>
                                                    <tr class="bold">
                                                        <td colspan="7">&nbsp; </td>
                                                        <td colspan="2">Total </td>
                                                        <td>@totalWorkplanWithVAT.ToString("N") </td>
                                                    </tr>
                                                }

                                                @if (sectionPln.PlanActivityPBCs == null && sectionPln.PlanActivities == null)
                                                {
                                                    <tr>
                                                        @if (roadId != sectionPln.RoadSection.ID)
                                                        {
                                                            //first time the section is met
                                                            <td>
                                                                @(sectionPln.Road != null ? sectionPln.Road.RoadNumber: "")
                                                            </td>
                                                            <td class="strong">
                                                                @sectionPln.RoadSection.SectionName
                                                            </td>
                                                            <td>
                                                                @(sectionPln.RoadSection.SurfaceType != null ? sectionPln.RoadSection.SurfaceType.Name : "")
                                                            </td>
                                                            <td> @sectionPln.RoadSection.Length.ToString("N")</td>
                                                        }
                                                        else
                                                        {
                                                            <td>&nbsp;</td>
                                                            <td>&nbsp;</td>
                                                            <td>&nbsp;</td>
                                                            <td>&nbsp;</td>
                                                        }
                                                        @{
                                                            //set the road ID to the outputted section ID, so that next time if repeated code above does not execute
                                                            roadId = sectionPln.RoadSection.ID;
                                                        }

                                                        <td>&nbsp;</td>
                                                        <td>&nbsp;</td>
                                                        <td>&nbsp;</td>
                                                        <td>&nbsp;</td>
                                                        <td>&nbsp;</td>
                                                        <td>&nbsp;</td>

                                                    </tr>
                                                }
                                            }
                                        }
                                        else // pick road for specific authority
                                        {

                                            var exclusionString = new string[] { "KeNHA", "KeRRA", "KURA", "KWS" };
                                            //List all county plans.
                                            foreach (var sectionPln in roadVar.Road.RoadWorkSectionPlans)
                                            {
                                                var countRow = 0;

                                                if (!exclusionString.Contains(sectionPln.Authority.Code))
                                                {
                                                    if (countRow == 0)
                                                    {
                                                        <tr class="black-text light-green lighten-5 bold strong">
                                                            <td colspan="10">
                                                                <span class="right">Road : @roadVar.Road.RoadName |  IRI / ARD : @String.Format("{0:0.00}", roadVar.RateOfDeterioration) | Road Total Estimate KSH @roadVar.Road.RoadWorkSectionPlans.Sum(t => t.TotalEstimateCost).ToString("N") </span>
                                                            </td>
                                                        </tr>
                                                        countRow++;
                                                    }
                                                    @if (sectionPln.PlanActivities != null)
                                                    {
                                                        foreach (var activity in sectionPln.PlanActivities)
                                                        {
                                                            <tr>
                                                                @if (roadId != sectionPln.RoadSection.ID)
                                                                {
                                                                    //first time the section is met
                                                                    <td>
                                                                        @(sectionPln.Road != null ? sectionPln.Road.RoadNumber: "")
                                                                    </td>
                                                                    <td class="strong">
                                                                        @sectionPln.RoadSection.SectionName
                                                                    </td>
                                                                    <td>
                                                                        @(sectionPln.RoadSection.SurfaceType != null ? sectionPln.RoadSection.SurfaceType.Name : "")
                                                                    </td>
                                                                    <td> @sectionPln.RoadSection.Length.ToString("N")</td>
                                                                }
                                                                else
                                                                {
                                                                    <td>&nbsp;</td>
                                                                    <td>&nbsp;</td>
                                                                    <td>&nbsp;</td>
                                                                    <td>&nbsp;</td>
                                                                }
                                                                @{
                                                                    //set the road ID to the outputted section ID, so that next time if repeated code above does not execute
                                                                    roadId = sectionPln.RoadSection.ID;
                                                                }
                                                                <td>@(activity.ItemActivityUnitCost.ItemCode +"-" + activity.ItemActivityUnitCost.SubItemCode + "-" + activity.ItemActivityUnitCost.SubSubItemCode) </td>
                                                                <td>@activity.ItemActivityUnitCost.Description </td>
                                                                <td>@activity.ItemActivityUnitCost.UnitCode </td>
                                                                <td>@activity.Quantity.ToString("N") </td>
                                                                <td>@activity.Rate.ToString("N")</td>
                                                                <td>@activity.Amount.ToString("N")</td>

                                                            </tr>
                                                        }
                                                    }

                                                    @if (sectionPln.PlanActivityPBCs != null)
                                                    {
                                                        foreach (var activity in sectionPln.PlanActivityPBCs)
                                                        {
                                                            <tr>
                                                                @if (roadId != sectionPln.RoadSection.ID)
                                                                {
                                                                    //first time the section is met
                                                                    <td>
                                                                        @(sectionPln.Road != null ? sectionPln.Road.RoadNumber: "")
                                                                    </td>
                                                                    <td class="strong">
                                                                        @sectionPln.RoadSection.SectionName
                                                                    </td>
                                                                    <td>
                                                                        @(sectionPln.RoadSection.SurfaceType != null ? sectionPln.RoadSection.SurfaceType.Name : "")
                                                                    </td>
                                                                    <td> @sectionPln.RoadSection.Length.ToString("N")</td>
                                                                }
                                                                else
                                                                {
                                                                    <td>&nbsp;</td>
                                                                    <td>&nbsp;</td>
                                                                    <td>&nbsp;</td>
                                                                    <td>&nbsp;</td>
                                                                }
                                                                @{
                                                                    //set the road ID to the outputted section ID, so that next time if repeated code above does not execute
                                                                    roadId = sectionPln.RoadSection.ID;
                                                                }
                                                                <td>@(activity.ItemActivityPBC.Code) </td>
                                                                <td>@activity.ItemActivityPBC.Description </td>
                                                                <td> <span>Cost Per KM</span> </td>
                                                                <td>@activity.PlannedKM) </td>
                                                                <td>@activity.CostPerKMPerMonth</td>
                                                                <td>@activity.TotalAmount.ToString("N")</td>

                                                            </tr>
                                                        }

                                                    }
                                                    @if (sectionPln.PlanActivities != null || sectionPln.PlanActivityPBCs != null)
                                                    {
                                                        // generate summaries for subtotal
                                                        var totalWorkplan = sectionPln.TotalEstimateCost;
                                                        var totalWorkplanWithVAT = (totalWorkplan * 1.16);
                                                        var VAT = (0.16 * totalWorkplan);
                                                        <tr class="bold">
                                                            <td colspan="7">&nbsp; </td>
                                                            <td colspan="2"> Subtotal (KSH) </td>
                                                            <td>@totalWorkplan.ToString("N") </td>
                                                        </tr>
                                                        <tr class="bold">
                                                            <td colspan="7">&nbsp; </td>
                                                            <td colspan="2">16% VAT </td>
                                                            <td>@VAT.ToString("N") </td>
                                                        </tr>
                                                        <tr class="bold">
                                                            <td colspan="7">&nbsp; </td>
                                                            <td colspan="2">Contigencies (0 %) </td>
                                                            <td> <span> - </span> </td>
                                                        </tr>
                                                        <tr class="bold">
                                                            <td colspan="7">&nbsp; </td>
                                                            <td colspan="2">Total </td>
                                                            <td>@totalWorkplanWithVAT.ToString("N") </td>
                                                        </tr>
                                                    }

                                                    @if (sectionPln.PlanActivityPBCs == null && sectionPln.PlanActivities == null)
                                                    {
                                                        <tr>
                                                            @if (roadId != sectionPln.RoadSection.ID)
                                                            {
                                                                //first time the section is met
                                                                <td>
                                                                    @(sectionPln.Road != null ? sectionPln.Road.RoadNumber: "")
                                                                </td>
                                                                <td class="strong">
                                                                    @sectionPln.RoadSection.SectionName
                                                                </td>
                                                                <td>
                                                                    @(sectionPln.RoadSection.SurfaceType != null ? sectionPln.RoadSection.SurfaceType.Name : "")
                                                                </td>
                                                                <td> @sectionPln.RoadSection.Length.ToString("N")</td>
                                                            }
                                                            else
                                                            {
                                                                <td>&nbsp;</td>
                                                                <td>&nbsp;</td>
                                                                <td>&nbsp;</td>
                                                                <td>&nbsp;</td>
                                                            }
                                                            @{
                                                                //set the road ID to the outputted section ID, so that next time if repeated code above does not execute
                                                                roadId = sectionPln.RoadSection.ID;
                                                            }

                                                            <td>&nbsp;</td>
                                                            <td>&nbsp;</td>
                                                            <td>&nbsp;</td>
                                                            <td>&nbsp;</td>
                                                            <td>&nbsp;</td>
                                                            <td>&nbsp;</td>

                                                        </tr>
                                                    }
                                                }

                                            }
                                        }
                                    }
                                }
                                else
                                {
                                    <tr>
                                        <td colspan="10"> No workplan roads available for view.</td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="divider"></div>
                <div class="row card-content">
                    <div class="card-content pb-1">
                        <h4 class="card-title mb-0">R200O Strategy Roads for approval</h4>
                    </div>
                    <div class="col s12 m6 l12 xl12">
                        <table id="workplan-table" class="subscription-table responsive-table highlight">
                            <thead>
                                <tr>
                                    <th>Road ID</th>
                                    <th>Section Name</th>
                                    <th>Surface Type</th>
                                    <th>Length (KM)</th>
                                    <th>Activity Code</th>
                                    <th>Acivity Description</th>
                                    <th>Unit</th>
                                    <th>Planned Quantity</th>
                                    <th>Planned Rate</th>
                                    <th>Amount (Ksh)</th>
                                </tr>
                            </thead>
                            <tbody>
                                @if (Model.WorkplanR2000Roads.Any())
                                {
                                    long roadId = 0;
                                    foreach (var roadVar in Model.WorkplanR2000Roads.OrderBy(i => i.Road.RoadNumber))
                                    {


                                        if (roadVar.Road.RoadWorkSectionPlans != null && Model.approvalAuthority != "COUNTY")
                                        {
                                            int countRow = 0;

                                            foreach (var sectionPln in roadVar.Road.RoadWorkSectionPlans.Where(a => a.Authority.Code == Model.approvalAuthority))
                                            {
                                                if (countRow == 0)
                                                {
                                                    <tr class="black-text light-green lighten-5 bold strong">
                                                        <td colspan="10">
                                                            <span class="right">Road : @roadVar.Road.RoadName |  IRI / ARD : @String.Format("{0:0.00}", roadVar.RateOfDeterioration) | Road Total Estimate KSH @roadVar.Road.RoadWorkSectionPlans.Sum(t => t.TotalEstimateCost).ToString("N") </span>
                                                        </td>
                                                    </tr>
                                                    countRow++;
                                                }
                                                @if (sectionPln.PlanActivities != null)
                                                {
                                                    foreach (var activity in sectionPln.PlanActivities)
                                                    {
                                                        <tr>
                                                            @if (roadId != sectionPln.RoadSection.ID)
                                                            {
                                                                //first time the section is met
                                                                <td>
                                                                    @(sectionPln.Road != null ? sectionPln.Road.RoadNumber: "")
                                                                </td>
                                                                <td class="strong">
                                                                    @sectionPln.RoadSection.SectionName
                                                                </td>
                                                                <td>
                                                                    @(sectionPln.RoadSection.SurfaceType != null ? sectionPln.RoadSection.SurfaceType.Name : "")
                                                                </td>
                                                                <td> @sectionPln.RoadSection.Length.ToString("N")</td>
                                                            }
                                                            else
                                                            {
                                                                <td>&nbsp;</td>
                                                                <td>&nbsp;</td>
                                                                <td>&nbsp;</td>
                                                                <td>&nbsp;</td>
                                                            }
                                                            @{
                                                                //set the road ID to the outputted section ID, so that next time if repeated code above does not execute
                                                                roadId = sectionPln.RoadSection.ID;
                                                            }
                                                            <td>@(activity.ItemActivityUnitCost.ItemCode +"-" + activity.ItemActivityUnitCost.SubItemCode + "-" + activity.ItemActivityUnitCost.SubSubItemCode) </td>
                                                            <td>@activity.ItemActivityUnitCost.Description </td>
                                                            <td>@activity.ItemActivityUnitCost.UnitCode </td>
                                                            <td>@activity.Quantity.ToString("N") </td>
                                                            <td>@activity.Rate.ToString("N")</td>
                                                            <td>@activity.Amount.ToString("N")</td>

                                                        </tr>
                                                    }
                                                }

                                                @if (sectionPln.PlanActivityPBCs != null)
                                                {
                                                    foreach (var activity in sectionPln.PlanActivityPBCs)
                                                    {
                                                        <tr>
                                                            @if (roadId != sectionPln.RoadSection.ID)
                                                            {
                                                                //first time the section is met
                                                                <td>
                                                                    @(sectionPln.Road != null ? sectionPln.Road.RoadNumber: "")
                                                                </td>
                                                                <td class="strong">
                                                                    @sectionPln.RoadSection.SectionName
                                                                </td>
                                                                <td>
                                                                    @(sectionPln.RoadSection.SurfaceType != null ? sectionPln.RoadSection.SurfaceType.Name : "")
                                                                </td>
                                                                <td> @sectionPln.RoadSection.Length.ToString("N")</td>
                                                            }
                                                            else
                                                            {
                                                                <td>&nbsp;</td>
                                                                <td>&nbsp;</td>
                                                                <td>&nbsp;</td>
                                                                <td>&nbsp;</td>
                                                            }
                                                            @{
                                                                //set the road ID to the outputted section ID, so that next time if repeated code above does not execute
                                                                roadId = sectionPln.RoadSection.ID;
                                                            }
                                                            <td>@(activity.ItemActivityPBC.Code) </td>
                                                            <td>@activity.ItemActivityPBC.Description </td>
                                                            <td> <span>Cost Per KM</span> </td>
                                                            <td>@activity.PlannedKM) </td>
                                                            <td>@activity.CostPerKMPerMonth</td>
                                                            <td>@activity.TotalAmount.ToString("N")</td>

                                                        </tr>
                                                    }

                                                }

                                                @if (sectionPln.PlanActivities != null || sectionPln.PlanActivityPBCs != null)
                                                {
                                                    // generate summaries for subtotal
                                                    var totalWorkplan = sectionPln.TotalEstimateCost;
                                                    var totalWorkplanWithVAT = (totalWorkplan * 1.16);
                                                    var VAT = (0.16 * totalWorkplan);
                                                    <tr class="bold">
                                                        <td colspan="7">&nbsp; </td>
                                                        <td colspan="2"> Subtotal (KSH) </td>
                                                        <td>@totalWorkplan.ToString("N") </td>
                                                    </tr>
                                                    <tr class="bold">
                                                        <td colspan="7">&nbsp; </td>
                                                        <td colspan="2">16% VAT </td>
                                                        <td>@VAT.ToString("N") </td>
                                                    </tr>
                                                    <tr class="bold">
                                                        <td colspan="7">&nbsp; </td>
                                                        <td colspan="2">Contigencies (0 %) </td>
                                                        <td> <span> - </span> </td>
                                                    </tr>
                                                    <tr class="bold">
                                                        <td colspan="7">&nbsp; </td>
                                                        <td colspan="2">Total </td>
                                                        <td>@totalWorkplanWithVAT.ToString("N") </td>
                                                    </tr>
                                                }

                                                @if (sectionPln.PlanActivityPBCs == null && sectionPln.PlanActivities == null)
                                                {
                                                    <tr>
                                                        @if (roadId != sectionPln.RoadSection.ID)
                                                        {
                                                            //first time the section is met
                                                            <td>
                                                                @(sectionPln.Road != null ? sectionPln.Road.RoadNumber: "")
                                                            </td>
                                                            <td class="strong">
                                                                @sectionPln.RoadSection.SectionName
                                                            </td>
                                                            <td>
                                                                @(sectionPln.RoadSection.SurfaceType != null ? sectionPln.RoadSection.SurfaceType.Name : "")
                                                            </td>
                                                            <td> @sectionPln.RoadSection.Length.ToString("N")</td>
                                                        }
                                                        else
                                                        {
                                                            <td>&nbsp;</td>
                                                            <td>&nbsp;</td>
                                                            <td>&nbsp;</td>
                                                            <td>&nbsp;</td>
                                                        }
                                                        @{
                                                            //set the road ID to the outputted section ID, so that next time if repeated code above does not execute
                                                            roadId = sectionPln.RoadSection.ID;
                                                        }

                                                        <td>&nbsp;</td>
                                                        <td>&nbsp;</td>
                                                        <td>&nbsp;</td>
                                                        <td>&nbsp;</td>
                                                        <td>&nbsp;</td>
                                                        <td>&nbsp;</td>

                                                    </tr>
                                                }
                                            }
                                        }
                                        else
                                        {
                                            var exclusionString = new string[] { "KeNHA", "KeRRA", "KURA", "KWS" };
                                            int countRow = 0;
                                            //List all county plans.


                                            foreach (var sectionPln in roadVar.Road.RoadWorkSectionPlans)
                                            {

                                                if (!exclusionString.Contains(sectionPln.Authority.Code))
                                                {
                                                    if (countRow == 0)
                                                    {
                                                        <tr class="black-text light-green lighten-5 bold strong">
                                                            <td colspan="10">
                                                                <span class="right">Road : @roadVar.Road.RoadName |  IRI / ARD : @String.Format("{0:0.00}", roadVar.RateOfDeterioration) | Road Total Estimate KSH @roadVar.Road.RoadWorkSectionPlans.Sum(t => t.TotalEstimateCost).ToString("N") </span>
                                                            </td>
                                                        </tr>
                                                        countRow++;
                                                    }
                                                    @if (sectionPln.PlanActivities != null)
                                                    {
                                                        foreach (var activity in sectionPln.PlanActivities)
                                                        {
                                                            <tr>
                                                                @if (roadId != sectionPln.RoadSection.ID)
                                                                {
                                                                    //first time the section is met
                                                                    <td>
                                                                        @(sectionPln.Road != null ? sectionPln.Road.RoadNumber: "")
                                                                    </td>
                                                                    <td class="strong">
                                                                        @sectionPln.RoadSection.SectionName
                                                                    </td>
                                                                    <td>
                                                                        @(sectionPln.RoadSection.SurfaceType != null ? sectionPln.RoadSection.SurfaceType.Name : "")
                                                                    </td>
                                                                    <td> @sectionPln.RoadSection.Length.ToString("N")</td>
                                                                }
                                                                else
                                                                {
                                                                    <td>&nbsp;</td>
                                                                    <td>&nbsp;</td>
                                                                    <td>&nbsp;</td>
                                                                    <td>&nbsp;</td>
                                                                }
                                                                @{
                                                                    //set the road ID to the outputted section ID, so that next time if repeated code above does not execute
                                                                    roadId = sectionPln.RoadSection.ID;
                                                                }
                                                                <td>@(activity.ItemActivityUnitCost.ItemCode +"-" + activity.ItemActivityUnitCost.SubItemCode + "-" + activity.ItemActivityUnitCost.SubSubItemCode) </td>
                                                                <td>@activity.ItemActivityUnitCost.Description </td>
                                                                <td>@activity.ItemActivityUnitCost.UnitCode </td>
                                                                <td>@activity.Quantity.ToString("N") </td>
                                                                <td>@activity.Rate.ToString("N")</td>
                                                                <td>@activity.Amount.ToString("N")</td>

                                                            </tr>
                                                        }
                                                    }

                                                    @if (sectionPln.PlanActivityPBCs != null)
                                                    {
                                                        foreach (var activity in sectionPln.PlanActivityPBCs)
                                                        {
                                                            <tr>
                                                                @if (roadId != sectionPln.RoadSection.ID)
                                                                {
                                                                    //first time the section is met
                                                                    <td>
                                                                        @(sectionPln.Road != null ? sectionPln.Road.RoadNumber: "")
                                                                    </td>
                                                                    <td class="strong">
                                                                        @sectionPln.RoadSection.SectionName
                                                                    </td>
                                                                    <td>
                                                                        @(sectionPln.RoadSection.SurfaceType != null ? sectionPln.RoadSection.SurfaceType.Name : "")
                                                                    </td>
                                                                    <td> @sectionPln.RoadSection.Length.ToString("N")</td>
                                                                }
                                                                else
                                                                {
                                                                    <td>&nbsp;</td>
                                                                    <td>&nbsp;</td>
                                                                    <td>&nbsp;</td>
                                                                    <td>&nbsp;</td>
                                                                }
                                                                @{
                                                                    //set the road ID to the outputted section ID, so that next time if repeated code above does not execute
                                                                    roadId = sectionPln.RoadSection.ID;
                                                                }
                                                                <td>@(activity.ItemActivityPBC.Code) </td>
                                                                <td>@activity.ItemActivityPBC.Description </td>
                                                                <td> <span>Cost Per KM</span> </td>
                                                                <td>@activity.PlannedKM) </td>
                                                                <td>@activity.CostPerKMPerMonth</td>
                                                                <td>@activity.TotalAmount.ToString("N")</td>

                                                            </tr>
                                                        }

                                                    }

                                                    @if (sectionPln.PlanActivities != null || sectionPln.PlanActivityPBCs != null)
                                                    {
                                                        // generate summaries for subtotal
                                                        var totalWorkplan = sectionPln.TotalEstimateCost;
                                                        var totalWorkplanWithVAT = (totalWorkplan * 1.16);
                                                        var VAT = (0.16 * totalWorkplan);
                                                        <tr class="bold">
                                                            <td colspan="7">&nbsp; </td>
                                                            <td colspan="2"> Subtotal (KSH) </td>
                                                            <td>@totalWorkplan.ToString("N") </td>
                                                        </tr>
                                                        <tr class="bold">
                                                            <td colspan="7">&nbsp; </td>
                                                            <td colspan="2">16% VAT </td>
                                                            <td>@VAT.ToString("N") </td>
                                                        </tr>
                                                        <tr class="bold">
                                                            <td colspan="7">&nbsp; </td>
                                                            <td colspan="2">Contigencies (0 %) </td>
                                                            <td> <span> - </span> </td>
                                                        </tr>
                                                        <tr class="bold">
                                                            <td colspan="7">&nbsp; </td>
                                                            <td colspan="2">Total </td>
                                                            <td>@totalWorkplanWithVAT.ToString("N") </td>
                                                        </tr>
                                                    }

                                                    @if (sectionPln.PlanActivityPBCs == null && sectionPln.PlanActivities == null)
                                                    {
                                                        <tr>
                                                            @if (roadId != sectionPln.RoadSection.ID)
                                                            {
                                                                //first time the section is met
                                                                <td>
                                                                    @(sectionPln.Road != null ? sectionPln.Road.RoadNumber: "")
                                                                </td>
                                                                <td class="strong">
                                                                    @sectionPln.RoadSection.SectionName
                                                                </td>
                                                                <td>
                                                                    @(sectionPln.RoadSection.SurfaceType != null ? sectionPln.RoadSection.SurfaceType.Name : "")
                                                                </td>
                                                                <td> @sectionPln.RoadSection.Length.ToString("N")</td>
                                                            }
                                                            else
                                                            {
                                                                <td>&nbsp;</td>
                                                                <td>&nbsp;</td>
                                                                <td>&nbsp;</td>
                                                                <td>&nbsp;</td>
                                                            }
                                                            @{
                                                                //set the road ID to the outputted section ID, so that next time if repeated code above does not execute
                                                                roadId = sectionPln.RoadSection.ID;
                                                            }

                                                            <td>&nbsp;</td>
                                                            <td>&nbsp;</td>
                                                            <td>&nbsp;</td>
                                                            <td>&nbsp;</td>
                                                            <td>&nbsp;</td>
                                                            <td>&nbsp;</td>

                                                        </tr>
                                                    }
                                                }

                                            }
                                        }
                                    }
                                }
                                else
                                {
                                    <tr>
                                        <td colspan="10"> No workplan roads available for view.</td>
                                    </tr>
                                }

                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="card #efebe9 brown lighten-5">
                <div class="row card-content">
                    <div class="col s12 m6 l12 xl12">
                        @if (Model.WorkplanApprovalBatch.ApprovalStatus == 0) //at initial stage, has not been (re)submitted
                        {
                            //check if user is in approver1 role (agency submitter)
                            if (User.IsInRole("Approver.Approver1") && ViewBag.Authority.Code != "KRB") //at first level, approval within the authority or county government ()
                            {
                                <a class="waves-effect waves-light btn right" href="#!" onclick="ShowApprovalForm('@Model.WorkplanApprovalBatch.ID')"><i class="material-icons right">send</i> Submit for Internal Reviews</a>
                            }
                            else
                            {
                                <span class="right strong black-text">The workplan is still in preparation stage.</span>
                            }

                        }
                        else if (Model.WorkplanApprovalBatch.ApprovalStatus == 1) //at initial stage, has not been resubmitted
                        {

                            //check if user is in approver1 role (agency submitter)
                            if (User.IsInRole("Approver.Approver2") && ViewBag.Authority.Code != "KRB") //at first level, approval within the authority or county government ()
                            {
                                <a class="waves-effect waves-light btn right" href="#!" onclick="ShowApprovalForm('@Model.WorkplanApprovalBatch.ID')"><i class="material-icons right">send</i>  Submit for Internal Reviews (Level 1 : @(Model.Authority.Type == 1 ? "Agency" : "County"))</a>
                            }
                            else
                            {
                                <span class="right strong black-text">This workplan is awaiting to be reviewed internally at Level 1.</span>
                            }


                        }
                        else if (Model.WorkplanApprovalBatch.ApprovalStatus == 2) //at second level, approval within the authority or county government ()
                        {

                            if (User.IsInRole("Approver.Approver3") && ViewBag.Authority.Code != "KRB")
                            {
                                if (ViewBag.Authority.Type == 1)
                                {
                                    <a class="waves-effect waves-light btn right" href="#!" onclick="ShowApprovalForm(@Model.WorkplanApprovalBatch.ID)"><i class="material-icons right">send</i> Submit for KRB Approvals</a>
                                }
                                else
                                {
                                    <a class="waves-effect waves-light btn right" href="#!" onclick="ShowApprovalForm(@Model.WorkplanApprovalBatch.ID)"><i class="material-icons right">send</i> Submit for Internal Reviews (Level 2 : @(Model.Authority.Type == 1 ? "Agency" : "County"))</a>
                                }

                            }
                            else
                            {
                                <span class="right strong black-text">This workplan is awaiting to be reviewed internally at Level 2.</span>
                            }

                        }
                        else if (Model.WorkplanApprovalBatch.ApprovalStatus == 3) //at third level, approval within the authority or county government
                        {
                            if (User.IsInRole("Approver.Approver4") && ViewBag.Authority.Code != "KRB")
                            {
                                <a class="waves-effect waves-light btn right" href="#!" onclick="ShowApprovalForm(@Model.WorkplanApprovalBatch.ID)"><i class="material-icons right">send</i>  Submit for KRB Approvals </a>
                            }
                            else
                            {
                                <span class="right strong black-text">This workplan is awaiting to be reviewed internally at Level 3.</span>
                            }

                        }
                        else if (Model.WorkplanApprovalBatch.ApprovalStatus == 4) //at first level, approval within the KRB
                        {
                            if (User.IsInRole("Approver.Approver5") && ViewBag.Authority.Code == "KRB")
                            {
                                <a class="waves-effect waves-light btn right" href="#!" onclick="ShowApprovalForm(@Model.WorkplanApprovalBatch.ID)"><i class="material-icons right">send</i> Submit for Internal Reviews (Level 1 : KRB))</a>
                            }
                            else
                            {
                                <span class="right strong black-text">This workplan is awaiting to be reviewed at KRB Level 1.</span>
                            }

                        }
                        else if (Model.WorkplanApprovalBatch.ApprovalStatus == 5)  //at second level, approval within the KRB
                        {
                            if (User.IsInRole("Approver.Approver6") && ViewBag.Authority.Code == "KRB")
                            {
                                <a class="waves-effect waves-light btn right" href="#!" onclick="ShowApprovalForm(@Model.WorkplanApprovalBatch.ID)"><i class="material-icons right">send</i> Submit for Internal Reviews (Level 2 : KRB) </a>
                            }
                            else
                            {
                                <span class="right strong black-text">This workplan is awaiting to be reviewed at KRB level 2.</span>
                            }
                        }
                        else if (Model.WorkplanApprovalBatch.ApprovalStatus == 6) //at second third level, approval within the KRB
                        {
                            if (User.IsInRole("Approver.Approver7") && ViewBag.Authority.Code == "KRB")
                            {
                                <a class="waves-effect waves-light btn right" href="#!" onclick="ShowApprovalForm(@Model.WorkplanApprovalBatch.ID)"><i class="material-icons right">send</i> Approve Workplan</a>
                            }
                            else
                            {
                                <span class="right strong black-text">This workplan is awaiting to be approved at KRB .</span>
                            }
                        }
                        else
                        {
                            <span class="right strong black-text">Workplan has been approved  at KRB.</span>
                        }
                    </div>
                </div>
            </div>
            @if (Model.WorkplanApprovalBatch.ApprovalStatus > 0 || Model.WorkplanApprovalBatch.WorkplanApprovalHistories.Any())
            {
                <div class="card card-default">
                    <div class="card-content">
                        <h4 class="card-title">
                            Compliance Checklist
                        </h4>
                        <hr />
                        <form action="#">
                            <div class="row">
                                <div class="col s8 offset-s2 ">
                                    <p>
                                        <label>
                                            @Html.CheckBoxFor(m => m.WorkplanApprovalBatch.isAricsDone, new { @disabled = "disabled" })
                                            <span>Arics Conducted Before Workplanning?</span>
                                        </label>
                                    </p>
                                    <p>
                                        <label>
                                            @Html.CheckBoxFor(m => m.WorkplanApprovalBatch.isRoadSafetyEnvironmentDone, new { @disabled = "disabled" })
                                            <span>Road safety initiatives and Environmental preservation considered?</span>
                                        </label>
                                    </p>

                                    <p>
                                        <label>
                                            @Html.CheckBoxFor(m => m.WorkplanApprovalBatch.isUnitRatesEstimateDone, new { @disabled = "disabled" })
                                            <span>Application of Cost Estimation Manual/market survey in formulation unit rates for road maintenance ? </span>
                                        </label>
                                    </p>
                                    <p>
                                        <label>
                                            @Html.CheckBoxFor(m => m.WorkplanApprovalBatch.isR2000AspectsDone, new { @disabled = "disabled" })
                                            <span>For roads to be implemented under Roads2000 Strategy, the work plan should include all aspects of the strategy including giving priority to local labour, use of local resources and mainstreaming of cross cutting issues. This considered? </span>
                                        </label>
                                    </p>
                                </div>
                            </div>
                        </form>

                    </div>
                </div>
            }
            @if (Model.WorkplanApprovalBatch.WorkplanApprovalHistories.Any())
            {
                <div class="card card-default">
                    <div class="card-content" id="work-section-select">
                        <h4 class="card-title">
                            Approval history for the workplan
                        </h4>
                        <hr />
                        <br />
                        @if (Model.WorkplanApprovalBatch.WorkplanApprovalHistories.Any())
                        {
                            <div class="row">
                                <div class="col s12 p-1">
                                    <ul class="collection">
                                        @foreach (var history in Model.WorkplanApprovalBatch.WorkplanApprovalHistories.OrderByDescending(d => d.ApprovalDate))
                                        {
                                            <li class="collection-item avatar">
                                                <span class="title">Submitted By : @history.ApprovalBy | Submission Date : @history.ApprovalDate.ToShortDateString()</span> <br /><br />
                                                <p>
                                                    @history.ApprovalComment
                                                </p> <br /><br />
                                                @if (!string.IsNullOrEmpty(history.documentLink))
                                                {
                                                    <a asp-controller="workplan" asp-action="DownLoadApprovalDocument" asp-route-approvalHistoryDocument="@history.documentLink" class="secondary-content"> Approval Attachment Document</a>
                                                }
                                            </li>
                                        }
                                    </ul>
                                </div>
                            </div>
                        }
                        else
                        {
                            <div class="row">
                                <div class="col s12 p-1">
                                    <ul class="collection">
                                        <li class="collection-item avatar">
                                            <span class="title">No Approvals History</span>
                                            <p>
                                                There are no workplan approval history records for this workplan.
                                            </p>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            }



            <div class="card-footer card-alert white-text  align-right">
                <div class="card-content">
                    <div id="modalViewApprovalId" class="modal">
                        <div class="modal-content grey-text text-darken-1" id="modalViewApprovalBodyDiv">

                        </div>
                        <div class="modal-footer">
                            <div class="row">
                                <div id="btnSubmit" class="col s8 offset-s2">
                                    <a href="#!" class="modal-close waves-effect waves-light btn-flat">Cancel</a>
                                    <a href="#!" class="waves-effect waves-light btn-small" onclick="SubmitWorkPlanForApproval()"><i class="material-icons left">cloud</i>Submit Record</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section vendorJS
{
    <script src="~/asset_default/app-assets/vendors/data-tables/js/jquery.dataTables.min.js" type="text/javascript"></script>
    <script src="~/asset_default/app-assets/vendors/data-tables/extensions/responsive/js/dataTables.responsive.min.js" type="text/javascript"></script>

    <script src="~/asset_default/app-assets/vendors/sweetalert/sweetalert.min.js" type="text/javascript"></script>

}

@section scripts

{
    <script src="~/asset_default/app-assets/js/scripts/app-contacts.js" type="text/javascript"></script>
    <script src="~/asset_default/app-assets/vendors/dropify/js/dropify.min.js"></script>

    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    <script>
        $(document).ready(function () {

            $.ajax({
                method: "POST",
                url: "/UserManagement/GetShortName",
                datatype: "json",
                data: {}
            })
                .done(function (data) {
                    //write json array object
                    console.log(data);
                    //Set Road Section ID to null

                    $("#idSpan").text(data.sn);
                    var Val1 = $("#idHomeAuthority").text();
                    $("#idHomeAuthority").text(Val1 + "-" + data.authorityCode); $("#idGlobalAuthority").text(data.authorityName);
                });

            $('.dropdown-trigger').dropdown();
        });


    </script>
}
<script type="text/javascript">

    //submit workplan for approval

    //load form for approval comments
    var ShowApprovalForm = function (workplanBatchId) {
        var urlLocation = "/Workplan/SubmitWorkplanInternal?workplanBatchId=" + workplanBatchId;
        $("#modalViewApprovalBodyDiv").load(urlLocation, function () {
            $("#modalViewApprovalId").modal('open');
        })
    }

    var SubmitARWPApproval = function () {
        var sendForm = $("#planApprovalFormSubmit").serialize();

        $.ajax(
            {
                type: "POST",
                url: "/Workplan/SubmitARWPApproval",
                data: sendForm,
                success: function (data) {
                    if (data.success) {
                        window.location.reload(false);
                    }
                    else {
                        swal(data.message, {
                            title: 'Cancelled',
                            icon: "error",
                        });
                    }
                }
            }
        );
    }

    var SubmitARWPRejection = function () {

    }

    var DownloadARWP = function (authorityId) {
        $.ajax({
            cache: false,
            url: '/Workplan/GetCombinedARWPForAgency?authorityId=' + authorityId,
            success: function (data) {
                if (data.success) {
                    window.location.href = data.href;
                }
                else {
                    swal(data.message, {
                        title: 'Cancelled',
                        icon: "error",
                    });
                }
            }
        });
    }

    var DownloadAPRP = function (authorityId) {
        $.ajax({
            cache: false,
            url: '/Workplan/GetAPRPForAgency?authorityId=' + authorityId,
            success: function (data) {
                if (data.success) {
                    window.location.href = data.href;
                }
                else {
                    swal(data.message, {
                        title: 'Cancelled',
                        icon: "error",
                    });
                }
            }
        });
    }

    var uploadBudgetForm = function () {
        swal({
            title: 'Cancelled',
            text: 'Budget form upload has an error, please contact the system administrator',
            icon: "error",
        });
    }
</script>

